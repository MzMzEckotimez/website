<h2 id="local-pp-requirepp"><code>local pp = require'pp'</code></h2>
<p>Fast, compact serialization producing portable Lua source code.</p>
<h2 id="input">Input</h2>
<ul>
<li>all Lua types except coroutines, userdata, cdata and C functions.</li>
<li>the ffi <code>int64_t</code> and <code>uint64_t</code> types.</li>
<li>values featuring the <code>__pwrite</code> metamethod.</li>
</ul>
<h2 id="output">Output</h2>
<ul>
<li><strong>compact</strong>: no spaces, dot notation for identifier keys, minimal quoting of strings, implicit keys for the array part of tables.</li>
<li><strong>portable</strong> between LuaJIT 2, Lua 5.1, Lua 5.2: dot key notation only for ascii identifiers, numbers are in decimal, NaN and Â±Inf are written as 0/0, 1/0 and -1/0 respectively.</li>
<li><strong>portable</strong> between Windows, Linux, Mac: quoting of <code>\n</code> and <code>\r</code> protects binary integrity when opening in text mode.</li>
<li><strong>embeddable</strong>: can be copy-pasted into Lua source code: quoting of <code>\0</code> and <code>\t</code> protects binary integrity with code editors.</li>
<li><strong>human readable</strong>: indentation (optional, configurable); array part printed separately with implicit keys.</li>
<li><strong>stream-based</strong>: the string bits are written with a writer function to minimize the amount of string concatenation and memory footprint.</li>
<li><strong>non-deterministic</strong>: table keys are not sorted, so not friendly to diff or checksum.</li>
<li><strong>non-identical</strong>: object identity is not tracked and is not preserved (table references are dereferenced).</li>
</ul>
<h2 id="limitations">Limitations</h2>
<ul>
<li>recursive: table nesting depth is stack-bound.</li>
<li>some fractions are not compact eg. the fraction 5/6 takes 19 bytes vs 8 bytes in its native double format.</li>
<li>strings need escaping which could become noticeable with large strings featuring many newlines, tabs, zero bytes, apostrophes, backslashes or control characters.</li>
<li>loading back the output with the Lua interpreter is not safe (no code is).</li>
</ul>
<h2 id="api">API</h2>
<h3 id="pp.printv1..."><code>pp.print(v1,...)</code></h3>
<h3 id="ppv1-..."><code>pp(v1, ...)</code></h3>
<p>Pretty-print the arguments to standard output. Cycle detection and indentation are enabled. Unserializable values get a comment in place.</p>
<h3 id="pp.writewrite-v-indent-parents-quote-onerror"><code>pp.write(write, v, [indent], [parents], [quote], [onerror])</code></h3>
<p>Pretty-print a value using a supplied write function that takes a string. The other arguments are:</p>
<ul>
<li><code>indent</code> - enable indentation eg. <code>'\t'</code> indents by one tab (default is compact output with no whitespace)</li>
<li><code>parents</code> - enable cycle detection eg. <code>{}</code></li>
<li><code>quote</code> - change string quoting eg. <code>'&quot;'</code> (default is &quot;'&quot;)</li>
<li><code>onerror</code> - enable error handling eg. <code>function(err_type, v, depth)   error(err_type..': '..tostring(v)) end</code></li>
</ul>
<p><strong>Example:</strong></p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">function</span> chunks<span class="ot">(</span>t<span class="ot">)</span>
   <span class="kw">return</span> coroutine<span class="ot">.</span>wrap<span class="ot">(</span><span class="kw">function</span><span class="ot">()</span>
      <span class="kw">return</span> pp<span class="ot">.</span>write<span class="ot">(</span>coroutine<span class="ot">.</span>yield<span class="ot">,</span> t<span class="ot">)</span>
   <span class="kw">end</span><span class="ot">)</span>
<span class="kw">end</span>

<span class="kw">for</span> s <span class="kw">in</span> chunks<span class="ot">(</span>t<span class="ot">)</span> <span class="kw">do</span>
   socket:send<span class="ot">(</span>s<span class="ot">)</span>
<span class="kw">end</span></code></pre>
<h3 id="pp.savefile-v-indent-parents-quote-onerror"><code>pp.save(file, v, [indent], [parents], [quote], [onerror])</code></h3>
<p>Pretty-print a value to a file.</p>
<h3 id="pp.formatv-indent-parents-quote-onerror---s"><code>pp.format(v, [indent], [parents], [quote], [onerror]) -&gt; s</code></h3>
<p>Pretty-print a value to a string.</p>
